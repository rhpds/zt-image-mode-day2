== A word about tags

As a review, the naming convention for container images is `registry/name:tag`. Let's examine the different images that are currently on this host.

[source,bash,run]
----
podman images
----


In the previous exercise, we used the `el10` tag when building the new RHEL 10 version of the image. You'll also see other images have version information in the TAG column. However, in other labs we didn't set an explicit tag, which means `podman` will use the default `latest` tag. While this is convenient, it can create a lot of confusion. What is in that `latest` container? Which updates did we provide? Have you seen the `latest` tag in any of the `bootc status` output so far?

== Using tags for identifying image contents

Let’s add some new content to our webserver in preparation for deploying
an application, then build it with a new tag.

Click on the link:tab-1[button label="`Containerfile`"
background="`#ee0000`" color="`#c7c7c7`"] tab.

If not already shown, select Containerfile in the list on the right side
of the tab.

image:../assets/containerfile_scripteditor1.png[../assets/containerfile_scripteditor1]

Add the following line at the end of the file:

....
RUN echo "New application coming soon!" > /var/www/html/index.html
....

image:../assets/containerfile_add_index.png[../assets/containerfile_add_index]


== Use podman to build the image

With our changes in the Containerfile saved, we will run
`+podman build+` to get a new image. But this time we’ll set a specific
tag by adding `+v2+` to the end of the container name. The container
tools once again reuse the pre-existing layers, only adding one for our
new web page.

[source,bash,run]
----
podman build -t registry-{guid}.{domain}/test-bootc:v2 .
----

== Push multiple tagged versions to the registry

Tags communicate information to people, not the container tools. The
tools will use the IDs associated to tag when doing operations. This
means we can use tags to carry different kinds of information for users.

Let’s say we also wanted to let people know this image was for the
development environment and not for production use. We could add a
`+dev+` tag to our new image with the `+podman image tag+` subcommand.
This tag is only applied locally, so we need push that to the registry
as well.

[source,bash,run]
----
podman image tag registry-{guid}.{domain}/test-bootc:v2 registry-{guid}.{domain}/test-bootc:dev
----

Look at the different images we’ve created.

[source,bash,run]
----
podman images test-bootc
----

You can see we have 3 images listed, but a closer look at the
`+IMAGE ID+` column shows that 2 of them are the same.

With more sophisticated tools than available in this lab environment,
the flexibility afforded by tags can be very powerful.

We need to push our updated images to the registry to make them
available for use. Notice that the `+dev+` tagged image only copies a
config layer since all of the other layers are identical to the `+v2+`
image.

[source,bash,run]
----
podman push registry-{guid}.{domain}/test-bootc:v2
----

[source,bash,run]
----
podman push registry-{guid}.{domain}/test-bootc:dev
----

== Switch to the v2 image

Click on the link:tab-2[button label="`VM SSH session`"
background="`#ee0000`" color="`#c7c7c7`"] tab.

____
{empty}[!NOTE] If the SSH session hasn’t connected or there is an error,
you can reconnect by clicking Refresh next to the tab name. The prompt
will look like this.
image:../assets/terminal_prompt.png[../assets/terminal_prompt]
____

You can use the following credentials to log in.

Password:

[source,bash,run]
----
redhat
----

The new images we pushed to the registry didn’t use the `+latest+` tag,
so they won’t be seen as an update by `+bootc+`. Notice there’s nothing
after the name `+test-bootc+` in the output.

[source,bash,run]
----
sudo bootc upgrade --check
----

Since tags are part of the image name, our new `+v2+` image is a
different image than what `+bootc+` is tracking. We can use
`+bootc switch+` to install it like we did in the first exercise to
change repositories. And since there are two tags that refer to the same
image, you could use either `+v2+` or `+dev+` to install the new image.

[source,bash,run]
----
sudo bootc switch registry-{guid}.{domain}/test-bootc:v2
----

Unlike the first exercise, `+bootc switch+` only pulls down the one
updated layer.

Using `+bootc switch+` we can handle a variety of different scenarios
that would require a different image than the one we booted that isn’t a
simple update. We could test the upgrade of a core application component
like a Java JDK by providing a new base image for the application. Or
test a whole OS upgrade, all while keeping our host information the
same. We’ll explore that a little later on.

We need to restart the system to apply our changes.

[source,bash,run]
----
sudo reboot
----

== Check the VM is running the v2 image

Once the system has completed rebooting, you can log back in by clicking
the refresh button.

Password:

[source,bash,run]
----
redhat
----

Let’s check what the `+spec+` section of `+bootc status+` now says about
where we’re looking for updates.

[source,bash,run]
----
sudo bootc status | grep spec: -A 4
----

There’s the `+v2+` tag, so what about our new placeholder index page?

[source,bash,run]
----
curl localhost
----

[source,bash,run]
----
ls -alh /var/www/html/index.html
----

The new index doesn’t appear, and it’s also not on disk. Yes, there’s a
deliberate error in the instructions. This is expected based on how
bootc handles directories and image contents during changes.

Stay logged into the VM to explore this in the next exercise.
